Shippo Spree Extension
=================

The Shippo Spree extensions connects a Spree store with Shippo. Shippo will import all orders via the Spree API, allowing you to obtain shipping labels for your shipping carriers on goshippo.com. Supported carriers include USPS, UPS, FedEx, DHL Express, Canada Post and many others. 

The extension will autoamtically create a new Spree user that you need to enter for your Shippo account. The setup is easy:

1. Create a free Shippo account at https://goshippo.com.
2. Enter your Spree's Shippo user API token in the Shippo Spree settings.

Your orders will then be imported automatically. Every shipping label you purchase on Shippo will set the Spree order automatically to "Shipped" and add the tracking number.

Installation
------------

Add spree_shippo_labels to your Gemfile:

```ruby
gem 'spree_shippo_labels'
```

Bundle your dependencies and run the installation generator:

```shell
bundle
bundle exec rails g spree_shippo_labels:install
```

Inside your spree app, add the following piece of code to the environment/initializers/spree.rb at the very bottom. 

```
Spree::PermittedAttributes.shipment_attributes << :tracking_url
Spree::PermittedAttributes.shipment_attributes << :parcel_object_id
Spree::PermittedAttributes.shipment_attributes << :shipment_obj_id
Spree::PermittedAttributes.shipment_attributes << :transaction_obj_id
Spree::PermittedAttributes.shipment_attributes << :label_url
Spree::PermittedAttributes.shipment_attributes << :return_shipment_obj_id
Spree::PermittedAttributes.shipment_attributes << :return_label_url
Spree::PermittedAttributes.shipment_attributes << :refund_object_id
Spree::PermittedAttributes.shipment_attributes << :label_cost
Spree::PermittedAttributes.shipment_attributes << :is_label
```

Configuration
------------

The Shippo extension allows chosen partners to automate the signup flow of Spree users. To obtain the required shippo_partner_key and shippo_partner_secret, please contact Shippo at support@goshippo.com. For individual stores, the configuration variables can be ignored.

#### Note
This extension is for platform partners, who manage hundreds or thousands of individual Spree sub-stores. This extension allows these partners to automatically connect each store. Our current version doesn't support Spree 3.0. Unfortunately, it's not in our short-term roadmap to bump the version.

For individual stores, however, you can easily integrate your store directly on our platform at [https://goshippo.com/user/connect/](https://goshippo.com/user/connect/) by providing your ***Store URL***, ***Store Name*** and ***API Access Token***. 

If you have a specific request regarding the integration of multiple stores, please contact support@goshippo.com. Our team will help you find the best solution! If you're an individual store, just go ahead and connect instantly at [https://goshippo.com/user/connect/](https://goshippo.com/user/connect/).

To integrate GoShippo Webhooks, the Webhook URLs need to be updated on GoShippo. On the API settings page on GoShippo, add the URL for webhook as follows:

```
"STORE URL"+/api/goshipments/update?token="API ACCESS TOKEN"

https://example.com/api/goshipments/update?token=fa8f85cc150c015qa2ff7c5cc100f533f623df928d0ae147

```


Testing
-------

First bundle your dependencies, then run `rake`. `rake` will default to building the dummy app if it does not exist, then it will run specs. The dummy app can be regenerated by using `rake test_app`.

```shell
bundle
bundle exec rake
```

When testing your applications integration with this extension you may use it's factories.
Simply add this require statement to your spec_helper:

```ruby
require 'spree_shippo_labels/factories'
```

Copyright (c) 2014 Shippo, released under the New BSD License
